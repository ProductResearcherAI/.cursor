---
description: Технические правила для обработки таймаутов и работы с длинными файлами
globs: .cursor/rules/*.mdc
---

# Технические правила для обработки таймаутов и работы с длинными файлами

## Общие принципы

1. **Не создавать новых промптов и правил, если уже существуют аналогичные**
   - Перед созданием нового файла обязательно проверить наличие существующего
   - Использовать поиск по имени файла или содержимому для проверки
   - При обнаружении существующего файла - модифицировать его, а не создавать новый

2. **Инкрементальный подход к чтению и редактированию файлов**
   - При работе с длинными файлами использовать чтение по частям
   - Разбивать файл на логические секции при чтении (по 50-100 строк)
   - Сохранять контекст между чтениями разных частей файла

## Обработка таймаутов при чтении файлов

1. **Стратегия при возникновении таймаута**
   - При первом таймауте уменьшить размер читаемого фрагмента в 2 раза
   - При повторном таймауте перейти к прямому редактированию файла
   - Использовать знание о структуре файла из предыдущих успешных операций

2. **Приоритизация операций**
   - Сначала выполнять критически важные изменения
   - При ограниченном времени фокусироваться на изменении формата вывода
   - Откладывать косметические изменения на последующие итерации

3. **Восстановление после таймаута**
   - Сохранять промежуточные результаты работы
   - При возобновлении работы начинать с последней успешной точки
   - Информировать пользователя о прогрессе и возникших проблемах

## Редактирование длинных файлов

1. **Подготовка к редактированию**
   - Перед редактированием проанализировать структуру файла
   - Определить ключевые секции, требующие изменений
   - Подготовить шаблоны для замены с учетом существующего форматирования

2. **Техника редактирования**
   - Использовать точечные изменения вместо полной перезаписи
   - Сохранять оригинальное форматирование и структуру
   - При необходимости полной перезаписи секции:
     * Четко обозначать начало и конец изменяемой секции
     * Использовать маркеры существующего кода
     * Сохранять идентичное форматирование

3. **Проверка после редактирования**
   - Валидировать синтаксическую корректность внесенных изменений
   - Проверять логическую целостность документа
   - Убедиться в сохранении всех ключевых элементов

## Работа с правилами и промптами

1. **Модификация существующих правил**
   - Сохранять оригинальную структуру правила
   - Обновлять только целевые секции (формат вывода, критерии и т.д.)
   - Поддерживать согласованность между связанными правилами

2. **Обновление промптов**
   - Сохранять оригинальную структуру промпта
   - Обновлять только секцию формата вывода, если не указано иное
   - Поддерживать согласованность между промптом и соответствующим правилом

3. **Согласованность между файлами**
   - При обновлении формата в одном файле обновлять все связанные файлы
   - Поддерживать единый формат JSON во всех связанных правилах и промптах
   - Обновлять карту правил при внесении существенных изменений

## Примеры успешных стратегий

1. **Прямое редактирование при таймаутах чтения**
   - При невозможности прочитать файл переходить к прямому редактированию
   - Использовать знание о структуре файла из документации или аналогичных файлов
   - Фокусироваться на изменении конкретной секции (например, OutputFormat)

2. **Инкрементальное обновление связанных файлов**
   - Обновлять файлы в порядке их важности
   - Начинать с правил, затем обновлять промпты
   - Завершать обновлением карты правил

3. **Обработка ошибок при редактировании**
   - При неудачном редактировании повторять попытку с меньшими изменениями
   - Разбивать большие изменения на серию малых изменений
   - Использовать альтернативные подходы при повторных неудачах 