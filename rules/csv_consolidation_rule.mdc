---
description: This rule is always used for creating CSV tables from a dataset. It outlines the mandatory conditions and iterative process for CSV file generation to ensure data integrity and consistent formatting.
globs: 
alwaysApply: false
---
This rule is **always used** for creating CSV tables from a dataset. It outlines the mandatory conditions and iterative process for CSV file generation to ensure data integrity and consistent formatting.

# Правило консолидации данных в CSV - табличное представление

## Обязательные условия создания CSV таблицы:


1.  **Создание структуры таблицы с заголовками:**
    *   Сначала создается таблица формата name.CSV, содержащая две строки заголовков: первая строка таблицы  - названия столбцов и вторая строка таблицы с пояснениями к каждому названию заголовка соответствующего столбца.

2.  **Внесение данных (построчно, батчами):**
    *   Данные в таблицу вносятся батчами, обрабатывая и записывая **по 3 строки за одну итерацию**. Сокращения данных при этом не допускаются.
    *   **Обрамление ячеек:** Абсолютно все значения во всех ячейках (включая пустые или содержащие только специальные символы) должны быть обрамлены двойными кавычками ("). Двойная кавычка ставится в самом начале значения ячейки и в самом конце значения ячейки.
        *   **Обработка пустых значений:** Если для заполнения какой-либо ячейки в исходных данных отсутствуют релевантные данные (значение является пустым), в эту ячейку записывается пустое значение, которое также обязательно обрамляется двойными кавычками (например, `""`).
    *   **Внутренние кавычки:** Если внутри значения ячейки необходимо использовать кавычки (например, для цитат), должны использоваться **только одинарные кавычки** ('). Все существующие двойные кавычки внутри содержимого ячейки заменяются на одинарные.

3.  **Итерационный процесс:**
    *   Агент сначала создает две первые строки заголовков (шапку и пояснения).
    *   Затем агент итерационно добавляет данные, обрабатывая и записывая не более 3 строк за одну операцию, строго следуя правилам обрамления ячеек и использования внутренних кавычек.
    *   После каждой итерации внесения данных агент ОБЯЗАТЕЛЬНО проверяет релевантность значений получившихся ячеек соответствующим заголовкам столбцов. При обнаружении несоответствий ('съездов') агент немедленно останавливается, анализирует причину ошибки и перерабатывает некорректный батч данных перед тем, как внести его в таблицу.


## Примеры:

### Как МОЖНО (правильно):

**Исходные данные для ячейки:**
Это "цитата" внутри текста, и еще одна 'цитата'.

**Обработанное значение ячейки в CSV:**
"Это 'цитата' внутри текста, и еще одна 'цитата'."

**Пример строки CSV с несколькими ячейками:**
"Имя","Описание","Цитата"
"Пояснение к имени","Пояснение к описанию","Пояснение к цитате"
"Алексей","Содержит запятую, и 'одинарные кавычки'.","Это 'очень важная' информация."
"Мария","Просто текст",""
*(Обратите внимание: пустая ячейка также обрамлена двойными кавычками)*

### Как НЕЛЬЗЯ (неправильно):

**1. Двойные кавычки внутри значения ячейки (кроме обрамляющих):**
"Неправильно","Содержит "внутренние" двойные кавычки","Ошибка"
*Вместо этого должно быть:*
"Неправильно","Содержит 'внутренние' двойные кавычки","Ошибка"

**2. Отсутствие обрамляющих двойных кавычек (особенно при наличии запятых или кавычек внутри):**
Имя,Описание с запятой, еще и "цитата",Комментарий

*Это приведет к неверному парсингу. Должно быть:*
"Имя","Описание с запятой, еще и 'цитата'","Комментарий"

**3. Использование одинарных кавычек для обрамления всей ячейки:**
'Имя','Описание','Цитата'
*Для обрамления всей ячейки всегда используются двойные кавычки.*
"Имя","Описание","Цитата"

**4. Неправильная обработка существующих двойных кавычек:**
*Исходные данные:* `Текст с """шестью кавычками""" подряд`
*Неправильно:* `"Текст с """шестью кавычками""" подряд"`
*Правильно:* `"Текст с 'шестью кавычками' подряд"` *(Важно, что внутри ячейки остаются только одинарные кавычки, а вся ячейка обрамлена двойными).*






