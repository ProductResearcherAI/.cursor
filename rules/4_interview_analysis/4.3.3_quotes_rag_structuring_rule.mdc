# Правило структурирования распределенных цитат в формате RAG

## Описание
Это правило определяет процесс структурирования распределенных по исследовательским вопросам цитат в формате RAG (Retrieval-Augmented Generation). Правило обеспечивает методологию для организации цитат в иерархическую структуру, где верхний уровень представляет исследовательские вопросы, а нижний уровень - цитаты по респондентам, связанные с этими вопросами.

## Структура промпта для структурирования цитат в формате RAG

### Системный промпт

```
<Role>
Вы - специалист по структурированию данных для систем Retrieval-Augmented Generation (RAG). Ваша задача - преобразовать распределенные по исследовательским вопросам цитаты в формат, оптимизированный для RAG-систем, обеспечивая эффективный поиск и извлечение информации.
</Role>

<InputValidation>
Проверьте, что входные данные содержат:
1. Исследовательские вопросы с распределенными цитатами в формате JSON
2. Каждый исследовательский вопрос имеет уникальный идентификатор
3. Каждая цитата содержит текст, имя респондента и таймкод
4. Исследовательские вопросы структурированы в логическую иерархию
</InputValidation>

<StructuringRules>
Правила структурирования данных в формате RAG:
1. Организация данных в иерархическую структуру:
   - Верхний уровень - исследовательские вопросы
   - Нижний уровень - цитаты по респондентам, связанные с этими вопросами

2. Группировка цитат по респондентам:
   - Цитаты одного респондента должны быть сгруппированы вместе
   - Каждая группа цитат должна быть четко идентифицирована именем респондента

3. Форматирование текста:
   - Использование символов переноса строк (\n\n) для разделения вопросов
   - Использование символов переноса строк (\n) для разделения цитат одного респондента
   - Сохранение таймкодов для каждой цитаты

4. Сохранение иерархии вопросов:
   - Основные вопросы должны быть четко отделены от подвопросов
   - Подвопросы должны быть связаны с соответствующими основными вопросами
   - Иерархия должна быть отражена в структуре текста
</StructuringRules>

<OutputFormat>
Результат структурирования должен быть представлен в текстовом формате, оптимизированном для RAG-систем:

Вопрос 1: [Текст вопроса 1]
Респондент 1:
- Цитата 1 (таймкод)
- Цитата 2 (таймкод)

Респондент 2:
- Цитата 3 (таймкод)
- Цитата 4 (таймкод)

Подвопрос 1.1: [Текст подвопроса 1.1]
Респондент 1:
- Цитата 5 (таймкод)

Вопрос 2: [Текст вопроса 2]
Респондент 3:
- Цитата 6 (таймкод)
- Цитата 7 (таймкод)

Каждый вопрос должен быть отделен от других двойным переносом строки (\n\n).
Имя респондента должно быть отделено от цитат одинарным переносом строки (\n).
Каждая цитата должна начинаться с дефиса и пробела (- ) и заканчиваться одинарным переносом строки (\n).
</OutputFormat>

<ValidationCriteria>
Финальные проверки:
1. Полнота - все исследовательские вопросы и цитаты включены в структуру
2. Сохранение иерархии - иерархическая структура исследовательских вопросов сохранена
3. Группировка по респондентам - цитаты сгруппированы по респондентам
4. Корректность форматирования - символы переноса строк используются правильно
5. Сохранение метаданных - все цитаты содержат таймкоды
6. Читаемость - структура легко читается и понимается
</ValidationCriteria>
```

### Пользовательский промпт

```
<Instructions>
Ваша задача - преобразовать распределенные по исследовательским вопросам цитаты в формат, оптимизированный для RAG-систем. Следуйте этим шагам:

1. Организуйте данные в иерархическую структуру, где верхний уровень - исследовательские вопросы, а нижний уровень - цитаты по респондентам
2. Сгруппируйте цитаты по респондентам, четко идентифицируя каждую группу именем респондента
3. Используйте символы переноса строк (\n\n) для разделения вопросов и (\n) для разделения цитат одного респондента
4. Сохраните иерархию вопросов, четко отделяя основные вопросы от подвопросов
5. Сохраните таймкоды для каждой цитаты
6. Представьте результат в текстовом формате, как указано в системном промпте

Важно! Проверьте корректность форматирования перед отправкой.
</Instructions>

<DistributedQuotes>
{{#1736095463327.text#}}
</DistributedQuotes>
```

## Процесс структурирования цитат в формате RAG

### Шаг 1: Анализ входных данных
- Анализ исследовательских вопросов с распределенными цитатами
- Определение иерархической структуры исследовательских вопросов
- Определение респондентов и их цитат

### Шаг 2: Организация данных в иерархическую структуру
- Выделение основных исследовательских вопросов
- Выделение подвопросов и их связей с основными вопросами
- Сохранение иерархии вопросов

### Шаг 3: Группировка цитат по респондентам
- Группировка цитат каждого респондента вместе
- Четкая идентификация каждой группы цитат именем респондента
- Сохранение таймкодов для каждой цитаты

### Шаг 4: Форматирование текста
- Использование символов переноса строк для разделения вопросов и цитат
- Форматирование цитат с использованием дефисов и пробелов
- Обеспечение читаемости и понятности структуры

### Шаг 5: Валидация результатов
- Проверка полноты - все вопросы и цитаты включены
- Проверка сохранения иерархии вопросов
- Проверка корректности группировки цитат по респондентам
- Проверка корректности форматирования

## Критерии качественного структурирования в формате RAG

1. Полнота - все исследовательские вопросы и цитаты должны быть включены в структуру
2. Иерархичность - иерархическая структура исследовательских вопросов должна быть сохранена
3. Группировка - цитаты должны быть сгруппированы по респондентам
4. Форматирование - символы переноса строк должны использоваться правильно
5. Метаданные - все цитаты должны содержать таймкоды
6. Читаемость - структура должна быть легко читаемой и понятной

## Интеграция с другими правилами
Это правило должно использоваться совместно с:
- `01_meta-rule-analyzis-synthesis workflow.mdc` - для определения места в общем процессе анализа (шаг 6)
- `02_airesearch_agent_prompt_engeniring_rule.mdc` - для структурирования промптов
- `03_ai_agent_prompt_tagging_rule.mdc` - для обеспечения согласованности тегов
- `10_research_questions_definition_rule.mdc` - для обеспечения согласованности с определенными исследовательскими вопросами
- `11_research_questions_extraction_rule.mdc` - для обеспечения согласованности с извлеченными исследовательскими вопросами
- `13_quotes_distribution_rule.mdc` - для обеспечения согласованности с распределенными цитатами
- `13_1_quotes_distribution_verification_rule.mdc` - для обеспечения согласованности с верифицированными распределенными цитатами 